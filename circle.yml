machine:
  node:
    version: 8.0.0

dependencies:
  override:
    - cd ./client && yarn && yarn build
    - cd ./server && yarn && npm run build
  cache_directories:
    - "node_modules"

deployment:
 master:
  branch: master
  commands:
   - echo 'deploying'
   - scp -r ./client/build root@dalet.tk:www/thesis/client
   - scp -r ./server/dist root@dalet.tk:www/thesis/server
   - ssh -v root@dalet.tk 'pm2 delete all && pm2 start /www/thesis/server/index.js'